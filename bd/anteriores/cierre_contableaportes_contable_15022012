-- View: contableaportes_contable

-- DROP VIEW contableaportes_contable;

CREATE OR REPLACE VIEW cierre_contableaportes_contable AS 
         SELECT scg_cuentas.sc_cuenta AS cuenta, 'D' AS operacion, sum(abs(sno_salida.valsal)) AS total, sno_concepto.codprov, sno_concepto.cedben, sno_concepto.codconc, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
           FROM sno_personalnomina, sno_unidadadmin, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
          WHERE sno_salida.valsal <> 0::double precision AND (sno_salida.tipsal = 'P2'::bpchar OR sno_salida.tipsal = 'V4'::bpchar OR sno_salida.tipsal = 'W4'::bpchar) AND sno_concepto.intprocon::text = '1'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND substr(sno_concepto.codpro::text, 1, 25) = spg_ep1.codestpro1::text AND spg_ep1.estcla::text = sno_concepto.estcla::text AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_unidadadmin.codemp AND sno_personalnomina.minorguniadm = sno_unidadadmin.minorguniadm AND sno_personalnomina.ofiuniadm = sno_unidadadmin.ofiuniadm AND sno_personalnomina.uniuniadm = sno_unidadadmin.uniuniadm AND sno_personalnomina.depuniadm = sno_unidadadmin.depuniadm AND sno_personalnomina.prouniadm = sno_unidadadmin.prouniadm AND spg_cuentas.codemp = sno_concepto.codemp AND spg_cuentas.spg_cuenta::bpchar = sno_concepto.cueprepatcon::bpchar AND spg_cuentas.sc_cuenta::bpchar = scg_cuentas.sc_cuenta::bpchar AND substr(sno_concepto.codpro::text, 1, 25) = spg_cuentas.codestpro1::text AND substr(sno_concepto.codpro::text, 26, 25) = spg_cuentas.codestpro2::text AND substr(sno_concepto.codpro::text, 51, 25) = spg_cuentas.codestpro3::text AND substr(sno_concepto.codpro::text, 76, 25) = spg_cuentas.codestpro4::text AND substr(sno_concepto.codpro::text, 101, 25) = spg_cuentas.codestpro5::text AND sno_concepto.estcla::text = spg_cuentas.estcla::text
          GROUP BY sno_concepto.codconc, scg_cuentas.sc_cuenta, sno_concepto.codprov, sno_concepto.cedben, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
UNION 
         SELECT scg_cuentas.sc_cuenta AS cuenta, 'D' AS operacion, sum(abs(sno_salida.valsal)) AS total, sno_concepto.codprov, sno_concepto.cedben, sno_concepto.codconc, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
           FROM sno_personalnomina, sno_unidadadmin, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
          WHERE sno_salida.valsal <> 0::double precision AND (sno_salida.tipsal = 'P2'::bpchar OR sno_salida.tipsal = 'V4'::bpchar OR sno_salida.tipsal = 'W4'::bpchar) AND sno_concepto.intprocon::text = '0'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND spg_ep1.codestpro1::text = substr(sno_unidadadmin.codprouniadm::text, 1, 25) AND spg_ep1.estcla::text = sno_unidadadmin.estcla::text AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_unidadadmin.codemp AND sno_personalnomina.minorguniadm = sno_unidadadmin.minorguniadm AND sno_personalnomina.ofiuniadm = sno_unidadadmin.ofiuniadm AND sno_personalnomina.uniuniadm = sno_unidadadmin.uniuniadm AND sno_personalnomina.depuniadm = sno_unidadadmin.depuniadm AND sno_personalnomina.prouniadm = sno_unidadadmin.prouniadm AND spg_cuentas.codemp = sno_concepto.codemp AND spg_cuentas.spg_cuenta::bpchar = sno_concepto.cueprepatcon::bpchar AND spg_cuentas.sc_cuenta::bpchar = scg_cuentas.sc_cuenta::bpchar AND substr(sno_unidadadmin.codprouniadm::text, 1, 25) = spg_cuentas.codestpro1::text AND substr(sno_unidadadmin.codprouniadm::text, 26, 25) = spg_cuentas.codestpro2::text AND substr(sno_unidadadmin.codprouniadm::text, 51, 25) = spg_cuentas.codestpro3::text AND substr(sno_unidadadmin.codprouniadm::text, 76, 25) = spg_cuentas.codestpro4::text AND substr(sno_unidadadmin.codprouniadm::text, 101, 25) = spg_cuentas.codestpro5::text AND sno_unidadadmin.estcla::text = spg_cuentas.estcla::text
          GROUP BY sno_concepto.codconc, scg_cuentas.sc_cuenta, sno_concepto.codprov, sno_concepto.cedben, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi;

ALTER TABLE cierre_contableaportes_contable OWNER TO postgres;


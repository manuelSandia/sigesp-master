-- View: contableaportes_contable

-- DROP VIEW contableaportes_contable;

CREATE OR REPLACE VIEW contableaportes_contable AS 
         SELECT spg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denoconta, 'D' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
           FROM sno_personalnomina, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
          WHERE sno_salida.valsal <> 0::double precision AND (sno_salida.tipsal = 'P2'::bpchar OR sno_salida.tipsal = 'V4'::bpchar OR sno_salida.tipsal = 'W4'::bpchar) AND sno_concepto.intprocon::text = '1'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND sno_concepto.codemp = spg_ep1.codemp AND sno_concepto.codestpro1 = spg_ep1.codestpro1 AND sno_concepto.estcla = spg_ep1.estcla AND sno_concepto.codemp = sno_concepto.codemp AND sno_concepto.cueprepatcon::text = spg_cuentas.spg_cuenta::text AND sno_concepto.codestpro1 = spg_cuentas.codestpro1 AND sno_concepto.codestpro2 = spg_cuentas.codestpro2 AND sno_concepto.codestpro3 = spg_cuentas.codestpro3 AND sno_concepto.codestpro4 = spg_cuentas.codestpro4 AND sno_concepto.codestpro5 = spg_cuentas.codestpro5 AND sno_concepto.estcla = spg_cuentas.estcla AND spg_cuentas.codemp = scg_cuentas.codemp AND spg_cuentas.sc_cuenta::text = scg_cuentas.sc_cuenta::text AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper
          GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, spg_cuentas.sc_cuenta
UNION 
         SELECT spg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denoconta, 'D' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
           FROM sno_personalnomina, sno_unidadadmin, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
          WHERE sno_salida.valsal <> 0::double precision AND (sno_salida.tipsal = 'P2'::bpchar OR sno_salida.tipsal = 'V4'::bpchar OR sno_salida.tipsal = 'W4'::bpchar) AND sno_concepto.intprocon::text = '0'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND spg_ep1.codemp = sno_unidadadmin.codemp AND spg_ep1.codestpro1 = sno_unidadadmin.codestpro1 AND spg_ep1.estcla = sno_unidadadmin.estcla AND sno_unidadadmin.codemp = spg_cuentas.codemp AND sno_unidadadmin.codestpro1 = spg_cuentas.codestpro1 AND sno_unidadadmin.codestpro2 = spg_cuentas.codestpro2 AND sno_unidadadmin.codestpro3 = spg_cuentas.codestpro3 AND sno_unidadadmin.codestpro4 = spg_cuentas.codestpro4 AND sno_unidadadmin.codestpro5 = spg_cuentas.codestpro5 AND sno_unidadadmin.estcla = spg_cuentas.estcla AND spg_cuentas.codemp = sno_concepto.codemp AND spg_cuentas.spg_cuenta::text = sno_concepto.cueprepatcon::text AND spg_cuentas.codemp = scg_cuentas.codemp AND spg_cuentas.sc_cuenta::text = scg_cuentas.sc_cuenta::text AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper AND sno_personalnomina.codemp = sno_unidadadmin.codemp AND sno_personalnomina.minorguniadm = sno_unidadadmin.minorguniadm AND sno_personalnomina.ofiuniadm = sno_unidadadmin.ofiuniadm AND sno_personalnomina.uniuniadm = sno_unidadadmin.uniuniadm AND sno_personalnomina.depuniadm = sno_unidadadmin.depuniadm AND sno_personalnomina.prouniadm = sno_unidadadmin.prouniadm
          GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, spg_cuentas.sc_cuenta;

ALTER TABLE contableaportes_contable OWNER TO postgres

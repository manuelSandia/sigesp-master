/*****procedimiento para cerrar nomina*************/


-- View: contableconceptos_contable

-- DROP VIEW contableconceptos_contable;

CREATE OR REPLACE VIEW contableconceptos_contable AS 
        (        (        (        (         SELECT scg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denominacion, 'D' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
                                           FROM sno_personalnomina, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
                                          WHERE (sno_salida.tipsal = 'A'::bpchar OR sno_salida.tipsal = 'V1'::bpchar OR sno_salida.tipsal = 'W1'::bpchar) AND sno_salida.valsal <> 0::double precision AND sno_concepto.intprocon::text = '1'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND sno_concepto.codemp = spg_ep1.codemp AND sno_concepto.codestpro1 = spg_ep1.codestpro1 AND sno_concepto.estcla = spg_ep1.estcla AND sno_concepto.codemp = spg_cuentas.codemp AND sno_concepto.cueprecon::text = spg_cuentas.spg_cuenta::text AND sno_concepto.codestpro1 = spg_cuentas.codestpro1 AND sno_concepto.codestpro2 = spg_cuentas.codestpro2 AND sno_concepto.codestpro3 = spg_cuentas.codestpro3 AND sno_concepto.codestpro4 = spg_cuentas.codestpro4 AND sno_concepto.codestpro5 = spg_cuentas.codestpro5 AND sno_concepto.estcla = spg_cuentas.estcla AND spg_cuentas.codemp = scg_cuentas.codemp AND spg_cuentas.sc_cuenta::text = scg_cuentas.sc_cuenta::text AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper
                                          GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, scg_cuentas.sc_cuenta
                                UNION 
                                         SELECT scg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denominacion, 'D' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
                                           FROM sno_personalnomina, sno_unidadadmin, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
                                          WHERE (sno_salida.tipsal = 'A'::bpchar OR sno_salida.tipsal = 'V1'::bpchar OR sno_salida.tipsal = 'W1'::bpchar) AND sno_salida.valsal <> 0::double precision AND sno_concepto.intprocon::text = '0'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND sno_unidadadmin.codemp = spg_ep1.codemp AND sno_unidadadmin.codestpro1 = spg_ep1.codestpro1 AND sno_unidadadmin.estcla = spg_ep1.estcla AND sno_concepto.codemp = spg_cuentas.codemp AND sno_concepto.cueprecon::text = spg_cuentas.spg_cuenta::text AND spg_cuentas.codemp = scg_cuentas.codemp AND spg_cuentas.sc_cuenta::text = scg_cuentas.sc_cuenta::text AND sno_unidadadmin.codemp = spg_cuentas.codemp AND sno_unidadadmin.codestpro1 = spg_cuentas.codestpro1 AND sno_unidadadmin.codestpro2 = spg_cuentas.codestpro2 AND sno_unidadadmin.codestpro3 = spg_cuentas.codestpro3 AND sno_unidadadmin.codestpro4 = spg_cuentas.codestpro4 AND sno_unidadadmin.codestpro5 = spg_cuentas.codestpro5 AND sno_unidadadmin.estcla = spg_cuentas.estcla AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper AND sno_personalnomina.codemp = sno_unidadadmin.codemp AND sno_personalnomina.minorguniadm = sno_unidadadmin.minorguniadm AND sno_personalnomina.ofiuniadm = sno_unidadadmin.ofiuniadm AND sno_personalnomina.uniuniadm = sno_unidadadmin.uniuniadm AND sno_personalnomina.depuniadm = sno_unidadadmin.depuniadm AND sno_personalnomina.prouniadm = sno_unidadadmin.prouniadm
                                          GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, scg_cuentas.sc_cuenta)
                        UNION 
                                 SELECT scg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denominacion, 'D' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
                                   FROM sno_personalnomina, sno_salida, sno_concepto, scg_cuentas
                                  WHERE (sno_salida.tipsal = 'A'::bpchar OR sno_salida.tipsal = 'V1'::bpchar OR sno_salida.tipsal = 'W1'::bpchar) AND sno_salida.valsal <> 0::double precision AND sno_concepto.intprocon::text = '0'::text AND scg_cuentas.status::text = 'C'::text AND sno_concepto.sigcon::text = 'B'::text AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND scg_cuentas.codemp = sno_concepto.codemp AND scg_cuentas.sc_cuenta::text = sno_concepto.cueconcon::text AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper
                                  GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, scg_cuentas.sc_cuenta)
                UNION 
                         SELECT scg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denominacion, 'H' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
                           FROM sno_personalnomina, sno_salida, sno_concepto, scg_cuentas
                          WHERE (sno_salida.tipsal = 'D'::bpchar OR sno_salida.tipsal = 'V2'::bpchar OR sno_salida.tipsal = 'W2'::bpchar OR sno_salida.tipsal = 'P1'::bpchar OR sno_salida.tipsal = 'V3'::bpchar OR sno_salida.tipsal = 'W3'::bpchar) AND sno_salida.valsal <> 0::double precision AND scg_cuentas.status::text = 'C'::text AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND scg_cuentas.codemp = sno_concepto.codemp AND scg_cuentas.sc_cuenta::text = sno_concepto.cueconcon::text AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper
                          GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, scg_cuentas.sc_cuenta)
        UNION 
                 SELECT scg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denominacion, 'H' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
                   FROM sno_personalnomina, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
                  WHERE (sno_salida.tipsal = 'D'::bpchar OR sno_salida.tipsal = 'V2'::bpchar OR sno_salida.tipsal = 'W2'::bpchar OR sno_salida.tipsal = 'P1'::bpchar OR sno_salida.tipsal = 'V3'::bpchar OR sno_salida.tipsal = 'W3'::bpchar) AND sno_salida.valsal <> 0::double precision AND sno_concepto.intprocon::text = '1'::text AND sno_concepto.sigcon::text = 'E'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND sno_concepto.codemp = spg_ep1.codemp AND sno_concepto.codestpro1 = spg_ep1.codestpro1 AND sno_concepto.estcla = spg_ep1.estcla AND sno_concepto.codemp = spg_cuentas.codemp AND sno_concepto.cueprecon::text = spg_cuentas.spg_cuenta::text AND sno_concepto.codestpro1 = spg_cuentas.codestpro1 AND sno_concepto.codestpro2 = spg_cuentas.codestpro2 AND sno_concepto.codestpro3 = spg_cuentas.codestpro3 AND sno_concepto.codestpro4 = spg_cuentas.codestpro4 AND sno_concepto.codestpro5 = spg_cuentas.codestpro5 AND sno_concepto.estcla = spg_cuentas.estcla AND spg_cuentas.codemp = scg_cuentas.codemp AND spg_cuentas.sc_cuenta::text = scg_cuentas.sc_cuenta::text AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper
                  GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, scg_cuentas.sc_cuenta)
UNION 
         SELECT scg_cuentas.sc_cuenta AS cuenta, max(scg_cuentas.denominacion::text) AS denominacion, 'H' AS operacion, sum(sno_salida.valsal) AS total, sno_salida.codemp, sno_salida.codnom, sno_salida.codperi
           FROM sno_personalnomina, sno_unidadadmin, sno_salida, sno_concepto, spg_cuentas, scg_cuentas, spg_ep1
          WHERE (sno_salida.tipsal = 'D'::bpchar OR sno_salida.tipsal = 'V2'::bpchar OR sno_salida.tipsal = 'W2'::bpchar OR sno_salida.tipsal = 'P1'::bpchar OR sno_salida.tipsal = 'V3'::bpchar OR sno_salida.tipsal = 'W3'::bpchar) AND sno_salida.valsal <> 0::double precision AND sno_concepto.intprocon::text = '0'::text AND sno_concepto.sigcon::text = 'E'::text AND spg_cuentas.status::text = 'C'::text AND spg_ep1.estint = 0 AND sno_unidadadmin.codemp = spg_ep1.codemp AND sno_unidadadmin.codestpro1 = spg_ep1.codestpro1 AND sno_unidadadmin.estcla = spg_ep1.estcla AND sno_unidadadmin.codemp = spg_cuentas.codemp AND sno_unidadadmin.codestpro1 = spg_cuentas.codestpro1 AND sno_unidadadmin.codestpro2 = spg_cuentas.codestpro2 AND sno_unidadadmin.codestpro3 = spg_cuentas.codestpro3 AND sno_unidadadmin.codestpro4 = spg_cuentas.codestpro4 AND sno_unidadadmin.codestpro5 = spg_cuentas.codestpro5 AND sno_unidadadmin.estcla = spg_cuentas.estcla AND spg_cuentas.codemp = sno_concepto.codemp AND spg_cuentas.spg_cuenta::text = sno_concepto.cueprecon::text AND spg_cuentas.codemp = scg_cuentas.codemp AND spg_cuentas.sc_cuenta::text = scg_cuentas.sc_cuenta::text AND sno_salida.codemp = sno_concepto.codemp AND sno_salida.codnom = sno_concepto.codnom AND sno_salida.codconc = sno_concepto.codconc AND sno_personalnomina.codemp = sno_salida.codemp AND sno_personalnomina.codnom = sno_salida.codnom AND sno_personalnomina.codper = sno_salida.codper AND sno_personalnomina.codemp = sno_unidadadmin.codemp AND sno_personalnomina.minorguniadm = sno_unidadadmin.minorguniadm AND sno_personalnomina.ofiuniadm = sno_unidadadmin.ofiuniadm AND sno_personalnomina.uniuniadm = sno_unidadadmin.uniuniadm AND sno_personalnomina.depuniadm = sno_unidadadmin.depuniadm AND sno_personalnomina.prouniadm = sno_unidadadmin.prouniadm
          GROUP BY sno_salida.codemp, sno_salida.codnom, sno_salida.codperi, scg_cuentas.sc_cuenta;

ALTER TABLE contableconceptos_contable OWNER TO postgres;

/***************fin************************/






